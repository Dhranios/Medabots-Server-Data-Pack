# Save which tinpet is being edited
execute store result score @s EditingTinpet run data get entity @s SelectedItemSlot
execute unless entity @s[nbt={SelectedItem:{}}] run scoreboard players set @s EditingTinpet 9

execute if entity @s[tag=has_medabot_form] run function medabots_server:items/player_interations/medabot/revert

tellraw @s {"translate":"chat.type.text","with":[{"translate":"medabots_server:item.tinpet","color":"green"},{"translate":"medabots_server:message.tinpet.edit"}]}
tellraw @s[scores={EditingTinpet=0..8},nbt={SelectedItem:{tag:{medabots_server:{id:"medabots_server:male_tinpet"}}}}] {"translate":"chat.type.text","with":[{"translate":"medabots_server:item.tinpet","color":"green"},{"translate":"medabots_server:message.tinpet.edit.male"}]}
tellraw @s[scores={EditingTinpet=0..8},nbt={SelectedItem:{tag:{medabots_server:{id:"medabots_server:female_tinpet"}}}}] {"translate":"chat.type.text","with":[{"translate":"medabots_server:item.tinpet","color":"green"},{"translate":"medabots_server:message.tinpet.edit.female"}]}
tellraw @s[scores={EditingTinpet=0..8},nbt={SelectedItem:{tag:{medabots_server:{id:"medabots_server:neutral_tinpet"}}}}] {"translate":"chat.type.text","with":[{"translate":"medabots_server:item.tinpet","color":"green"},{"translate":"medabots_server:message.tinpet.edit.neutral"}]}
tellraw @s[scores={EditingTinpet=9},nbt={Inventory:[{Slot:-106b,tag:{medabots_server:{id:"medabots_server:male_tinpet"}}}]}] {"translate":"chat.type.text","with":[{"translate":"medabots_server:item.tinpet","color":"green"},{"translate":"medabots_server:message.tinpet.edit.male"}]}
tellraw @s[scores={EditingTinpet=9},nbt={Inventory:[{Slot:-106b,tag:{medabots_server:{id:"medabots_server:female_tinpet"}}}]}] {"translate":"chat.type.text","with":[{"translate":"medabots_server:item.tinpet","color":"green"},{"translate":"medabots_server:message.tinpet.edit.female"}]}
tellraw @s[scores={EditingTinpet=9},nbt={Inventory:[{Slot:-106b,tag:{medabots_server:{id:"medabots_server:neutral_tinpet"}}}]}] {"translate":"chat.type.text","with":[{"translate":"medabots_server:item.tinpet","color":"green"},{"translate":"medabots_server:message.tinpet.edit.neutral"}]}
tellraw @s {"translate":"chat.type.text","with":[{"translate":"medabots_server:item.tinpet","color":"green"},{"translate":"medabots_server:message.tinpet.edit.unequip","clickEvent":{"action":"run_command","value":"/trigger UnequipTinpet"}}]}
scoreboard players enable @s UnequipTinpet

# Medawatch music
execute unless entity @s[scores={MusicType=58..59}] run scoreboard players operation @s OldMusicType = @s MusicType
scoreboard players set @s MusicType 31
execute unless entity @s[scores={Jukebox=1..}] run scoreboard players set @s Music 0

summon minecraft:armor_stand ~ ~ ~ {NoGravity:1b,Invisible:1b,Marker:1b,Tags:["source","medabot_model","model_piece","new","found_owner","found_owner_2","tinpet_editing"],CustomName:'{"translate":"medabots_server:entity.model_piece"}'}
summon minecraft:armor_stand ~ ~ ~ {NoGravity:1b,Invisible:1b,Marker:1b,Tags:["legs","medabot_model","model_piece","new","found_owner","found_owner_2","tinpet_editing"],CustomName:'{"translate":"medabots_server:entity.model_piece"}'}
summon minecraft:armor_stand ~ ~ ~ {NoGravity:1b,Invisible:1b,Marker:1b,Tags:["left_arm","medabot_model","model_piece","new","found_owner","found_owner_2","tinpet_editing"],CustomName:'{"translate":"medabots_server:entity.model_piece"}'}
summon minecraft:armor_stand ~ ~ ~ {NoGravity:1b,Invisible:1b,Marker:1b,Tags:["right_arm","medabot_model","model_piece","new","found_owner","found_owner_2","tinpet_editing"],CustomName:'{"translate":"medabots_server:entity.model_piece"}'}
summon minecraft:armor_stand ~ ~ ~ {NoGravity:1b,Invisible:1b,Marker:1b,Tags:["head","medabot_model","model_piece","new","found_owner","found_owner_2","tinpet_editing"],CustomName:'{"translate":"medabots_server:entity.model_piece"}'}
summon minecraft:armor_stand ~ ~ ~ {NoGravity:1b,Invisible:1b,Marker:1b,Tags:["medal","medabot_model","model_piece","new","found_owner","found_owner_2","tinpet_editing"],CustomName:'{"translate":"medabots_server:entity.model_piece"}'}
scoreboard players operation @s MedabotNr > @e[scores={MedabotNr=0..}] MedabotNr
scoreboard players add @s MedabotNr 1
execute at @s as @e[tag=medabot_model,tag=new] run scoreboard players operation @s MedabotNr = @a[distance=..0.1,limit=1] MedabotNr
execute at @s[scores={EditingTinpet=0..8},nbt={SelectedItem:{tag:{medabots_server:{id:"medabots_server:male_tinpet"}}}}] unless entity @s[nbt={SelectedItem:{tag:{medabots_server:{items:{legs:{tag:{medabots_server:{part:"legs"}}}}}}}}] run item entity @e[tag=legs,tag=new] armor.head replace minecraft:fishing_rod{Damage:1,Unbreakable:1b,CustomModelData:-1,medabots_server:{part:"legs",model_data:{height:0,legs:[{l:0,u:0,r:0},{l:0,u:0,r:0}]}}}
execute at @s[scores={EditingTinpet=0..8},nbt={SelectedItem:{tag:{medabots_server:{id:"medabots_server:female_tinpet"}}}}] unless entity @s[nbt={SelectedItem:{tag:{medabots_server:{items:{legs:{tag:{medabots_server:{part:"legs"}}}}}}}}] run item entity @e[tag=legs,tag=new] armor.head replace minecraft:fishing_rod{Damage:1,Unbreakable:1b,CustomModelData:-2,medabots_server:{part:"legs",model_data:{height:0,legs:[{l:0,u:0,r:0},{l:0,u:0,r:0}]}}}
execute at @s[scores={EditingTinpet=0..8},nbt={SelectedItem:{tag:{medabots_server:{id:"medabots_server:neutral_tinpet"}}}}] unless entity @s[nbt={SelectedItem:{tag:{medabots_server:{items:{legs:{tag:{medabots_server:{part:"legs"}}}}}}}}] run item entity @e[tag=legs,tag=new] armor.head replace minecraft:fishing_rod{Damage:1,Unbreakable:1b,CustomModelData:-3,medabots_server:{part:"legs",model_data:{height:0,legs:[{l:0,u:0,r:0},{l:0,u:0,r:0}]}}}
execute at @s[scores={EditingTinpet=9},nbt={Inventory:[{Slot:-106b,tag:{medabots_server:{id:"medabots_server:male_tinpet"}}}]}] unless entity @s[nbt={Inventory:[{Slot:-106b,tag:{medabots_server:{items:{legs:{tag:{medabots_server:{part:"legs"}}}}}}}]}] run item entity @e[tag=legs,tag=new] armor.head replace minecraft:fishing_rod{Damage:1,Unbreakable:1b,CustomModelData:-1,medabots_server:{part:"legs",model_data:{height:0,legs:[{l:0,u:0,r:0},{l:0,u:0,r:0}]}}}
execute at @s[scores={EditingTinpet=9},nbt={Inventory:[{Slot:-106b,tag:{medabots_server:{id:"medabots_server:female_tinpet"}}}]}] unless entity @s[nbt={Inventory:[{Slot:-106b,tag:{medabots_server:{items:{legs:{tag:{medabots_server:{part:"legs"}}}}}}}]}] run item entity @e[tag=legs,tag=new] armor.head replace minecraft:fishing_rod{Damage:1,Unbreakable:1b,CustomModelData:-2,medabots_server:{part:"legs",model_data:{height:0,legs:[{l:0,u:0,r:0},{l:0,u:0,r:0}]}}}
execute at @s[scores={EditingTinpet=9},nbt={Inventory:[{Slot:-106b,tag:{medabots_server:{id:"medabots_server:neutral_tinpet"}}}]}] unless entity @s[nbt={Inventory:[{Slot:-106b,tag:{medabots_server:{items:{legs:{tag:{medabots_server:{part:"legs"}}}}}}}]}] run item entity @e[tag=legs,tag=new] armor.head replace minecraft:fishing_rod{Damage:1,Unbreakable:1b,CustomModelData:-3,medabots_server:{part:"legs",model_data:{height:0,legs:[{l:0,u:0,r:0},{l:0,u:0,r:0}]}}}
execute at @s[scores={EditingTinpet=0..8},nbt={SelectedItem:{tag:{medabots_server:{id:"medabots_server:male_tinpet"}}}}] unless entity @s[nbt={SelectedItem:{tag:{medabots_server:{items:{left_arm:{tag:{medabots_server:{part:"left_arm"}}}}}}}}] run item entity @e[tag=left_arm,tag=new] armor.head replace minecraft:fishing_rod{Damage:2,Unbreakable:1b,CustomModelData:-1,medabots_server:{part:"left_arm"}}
execute at @s[scores={EditingTinpet=0..8},nbt={SelectedItem:{tag:{medabots_server:{id:"medabots_server:female_tinpet"}}}}] unless entity @s[nbt={SelectedItem:{tag:{medabots_server:{items:{left_arm:{tag:{medabots_server:{part:"left_arm"}}}}}}}}] run item entity @e[tag=left_arm,tag=new] armor.head replace minecraft:fishing_rod{Damage:2,Unbreakable:1b,CustomModelData:-2,medabots_server:{part:"left_arm"}}
execute at @s[scores={EditingTinpet=0..8},nbt={SelectedItem:{tag:{medabots_server:{id:"medabots_server:neutral_tinpet"}}}}] unless entity @s[nbt={SelectedItem:{tag:{medabots_server:{items:{left_arm:{tag:{medabots_server:{part:"left_arm"}}}}}}}}] run item entity @e[tag=left_arm,tag=new] armor.head replace minecraft:fishing_rod{Damage:2,Unbreakable:1b,CustomModelData:-3,medabots_server:{part:"left_arm"}}
execute at @s[scores={EditingTinpet=9},nbt={Inventory:[{Slot:-106b,tag:{medabots_server:{id:"medabots_server:male_tinpet"}}}]}] unless entity @s[nbt={Inventory:[{Slot:-106b,tag:{medabots_server:{items:{left_arm:{tag:{medabots_server:{part:"left_arm"}}}}}}}]}] run item entity @e[tag=left_arm,tag=new] armor.head replace minecraft:fishing_rod{Damage:2,Unbreakable:1b,CustomModelData:-1,medabots_server:{part:"left_arm"}}
execute at @s[scores={EditingTinpet=9},nbt={Inventory:[{Slot:-106b,tag:{medabots_server:{id:"medabots_server:female_tinpet"}}}]}] unless entity @s[nbt={Inventory:[{Slot:-106b,tag:{medabots_server:{items:{left_arm:{tag:{medabots_server:{part:"left_arm"}}}}}}}]}] run item entity @e[tag=left_arm,tag=new] armor.head replace minecraft:fishing_rod{Damage:2,Unbreakable:1b,CustomModelData:-2,medabots_server:{part:"left_arm"}}
execute at @s[scores={EditingTinpet=9},nbt={Inventory:[{Slot:-106b,tag:{medabots_server:{id:"medabots_server:neutral_tinpet"}}}]}] unless entity @s[nbt={Inventory:[{Slot:-106b,tag:{medabots_server:{items:{left_arm:{tag:{medabots_server:{part:"left_arm"}}}}}}}]}] run item entity @e[tag=left_arm,tag=new] armor.head replace minecraft:fishing_rod{Damage:2,Unbreakable:1b,CustomModelData:-3,medabots_server:{part:"left_arm"}}
execute at @s[scores={EditingTinpet=0..8},nbt={SelectedItem:{tag:{medabots_server:{id:"medabots_server:male_tinpet"}}}}] unless entity @s[nbt={SelectedItem:{tag:{medabots_server:{items:{right_arm:{tag:{medabots_server:{part:"right_arm"}}}}}}}}] run item entity @e[tag=right_arm,tag=new] armor.head replace minecraft:fishing_rod{Damage:3,Unbreakable:1b,CustomModelData:-1,medabots_server:{part:"right_arm"}}
execute at @s[scores={EditingTinpet=0..8},nbt={SelectedItem:{tag:{medabots_server:{id:"medabots_server:female_tinpet"}}}}] unless entity @s[nbt={SelectedItem:{tag:{medabots_server:{items:{right_arm:{tag:{medabots_server:{part:"right_arm"}}}}}}}}] run item entity @e[tag=right_arm,tag=new] armor.head replace minecraft:fishing_rod{Damage:3,Unbreakable:1b,CustomModelData:-2,medabots_server:{part:"right_arm"}}
execute at @s[scores={EditingTinpet=0..8},nbt={SelectedItem:{tag:{medabots_server:{id:"medabots_server:neutral_tinpet"}}}}] unless entity @s[nbt={SelectedItem:{tag:{medabots_server:{items:{right_arm:{tag:{medabots_server:{part:"right_arm"}}}}}}}}] run item entity @e[tag=right_arm,tag=new] armor.head replace minecraft:fishing_rod{Damage:3,Unbreakable:1b,CustomModelData:-3,medabots_server:{part:"right_arm"}}
execute at @s[scores={EditingTinpet=9},nbt={Inventory:[{Slot:-106b,tag:{medabots_server:{id:"medabots_server:male_tinpet"}}}]}] unless entity @s[nbt={Inventory:[{Slot:-106b,tag:{medabots_server:{items:{right_arm:{tag:{medabots_server:{part:"right_arm"}}}}}}}]}] run item entity @e[tag=right_arm,tag=new] armor.head replace minecraft:fishing_rod{Damage:3,Unbreakable:1b,CustomModelData:-1,medabots_server:{part:"right_arm"}}
execute at @s[scores={EditingTinpet=9},nbt={Inventory:[{Slot:-106b,tag:{medabots_server:{id:"medabots_server:female_tinpet"}}}]}] unless entity @s[nbt={Inventory:[{Slot:-106b,tag:{medabots_server:{items:{right_arm:{tag:{medabots_server:{part:"right_arm"}}}}}}}]}] run item entity @e[tag=right_arm,tag=new] armor.head replace minecraft:fishing_rod{Damage:3,Unbreakable:1b,CustomModelData:-2,medabots_server:{part:"right_arm"}}
execute at @s[scores={EditingTinpet=9},nbt={Inventory:[{Slot:-106b,tag:{medabots_server:{id:"medabots_server:neutral_tinpet"}}}]}] unless entity @s[nbt={Inventory:[{Slot:-106b,tag:{medabots_server:{items:{right_arm:{tag:{medabots_server:{part:"right_arm"}}}}}}}]}] run item entity @e[tag=right_arm,tag=new] armor.head replace minecraft:fishing_rod{Damage:3,Unbreakable:1b,CustomModelData:-3,medabots_server:{part:"right_arm"}}
execute at @s[scores={EditingTinpet=0..8},nbt={SelectedItem:{tag:{medabots_server:{id:"medabots_server:male_tinpet"}}}}] unless entity @s[nbt={SelectedItem:{tag:{medabots_server:{items:{head:{tag:{medabots_server:{part:"head"}}}}}}}}] run item entity @e[tag=head,tag=new] armor.head replace minecraft:fishing_rod{Damage:4,Unbreakable:1b,CustomModelData:-1,medabots_server:{part:"head"}}
execute at @s[scores={EditingTinpet=0..8},nbt={SelectedItem:{tag:{medabots_server:{id:"medabots_server:female_tinpet"}}}}] unless entity @s[nbt={SelectedItem:{tag:{medabots_server:{items:{head:{tag:{medabots_server:{part:"head"}}}}}}}}] run item entity @e[tag=head,tag=new] armor.head replace minecraft:fishing_rod{Damage:4,Unbreakable:1b,CustomModelData:-2,medabots_server:{part:"head"}}
execute at @s[scores={EditingTinpet=0..8},nbt={SelectedItem:{tag:{medabots_server:{id:"medabots_server:neutral_tinpet"}}}}] unless entity @s[nbt={SelectedItem:{tag:{medabots_server:{items:{head:{tag:{medabots_server:{part:"head"}}}}}}}}] run item entity @e[tag=head,tag=new] armor.head replace minecraft:fishing_rod{Damage:4,Unbreakable:1b,CustomModelData:-3,medabots_server:{part:"head"}}
execute at @s[scores={EditingTinpet=9},nbt={Inventory:[{Slot:-106b,tag:{medabots_server:{id:"medabots_server:male_tinpet"}}}]}] unless entity @s[nbt={Inventory:[{Slot:-106b,tag:{medabots_server:{items:{head:{tag:{medabots_server:{part:"head"}}}}}}}]}] run item entity @e[tag=head,tag=new] armor.head replace minecraft:fishing_rod{Damage:4,Unbreakable:1b,CustomModelData:-1,medabots_server:{part:"head"}}
execute at @s[scores={EditingTinpet=9},nbt={Inventory:[{Slot:-106b,tag:{medabots_server:{id:"medabots_server:female_tinpet"}}}]}] unless entity @s[nbt={Inventory:[{Slot:-106b,tag:{medabots_server:{items:{head:{tag:{medabots_server:{part:"head"}}}}}}}]}] run item entity @e[tag=head,tag=new] armor.head replace minecraft:fishing_rod{Damage:4,Unbreakable:1b,CustomModelData:-2,medabots_server:{part:"head"}}
execute at @s[scores={EditingTinpet=9},nbt={Inventory:[{Slot:-106b,tag:{medabots_server:{id:"medabots_server:neutral_tinpet"}}}]}] unless entity @s[nbt={Inventory:[{Slot:-106b,tag:{medabots_server:{items:{head:{tag:{medabots_server:{part:"head"}}}}}}}]}] run item entity @e[tag=head,tag=new] armor.head replace minecraft:fishing_rod{Damage:4,Unbreakable:1b,CustomModelData:-3,medabots_server:{part:"head"}}
execute at @s[scores={EditingTinpet=0..8}] unless entity @s[nbt={SelectedItem:{tag:{medabots_server:{items:{medal:{tag:{medabots_server:{part:"medal"}}}}}}}}] run item entity @e[tag=medal,tag=new] armor.head replace minecraft:fishing_rod{Damage:6,Unbreakable:1b,CustomModelData:-1,medabots_server:{part:"medal"}}
execute at @s[scores={EditingTinpet=9}] unless entity @s[nbt={Inventory:[{Slot:-106b,tag:{medabots_server:{items:{medal:{tag:{medabots_server:{part:"medal"}}}}}}}]}] run item entity @e[tag=medal,tag=new] armor.head replace minecraft:fishing_rod{Damage:6,Unbreakable:1b,CustomModelData:-1,medabots_server:{part:"medal"}}
execute at @s[scores={EditingTinpet=0..8}] as @e[tag=legs,tag=new] run data modify entity @s ArmorItems[3] merge from entity @a[distance=..0.1,limit=1] SelectedItem.tag.medabots_server.items.legs
execute at @s[scores={EditingTinpet=0..8}] as @e[tag=left_arm,tag=new] run data modify entity @s ArmorItems[3] merge from entity @a[distance=..0.1,limit=1] SelectedItem.tag.medabots_server.items.left_arm
execute at @s[scores={EditingTinpet=0..8}] as @e[tag=right_arm,tag=new] run data modify entity @s ArmorItems[3] merge from entity @a[distance=..0.1,limit=1] SelectedItem.tag.medabots_server.items.right_arm
execute at @s[scores={EditingTinpet=0..8}] as @e[tag=head,tag=new] run data modify entity @s ArmorItems[3] merge from entity @a[distance=..0.1,limit=1] SelectedItem.tag.medabots_server.items.head
execute at @s[scores={EditingTinpet=0..8}] as @e[tag=medal,tag=new] run data modify entity @s ArmorItems[3] merge from entity @a[distance=..0.1,limit=1] SelectedItem.tag.medabots_server.items.medal
execute at @s[scores={EditingTinpet=9}] as @e[tag=legs,tag=new] run data modify entity @s ArmorItems[3] merge from entity @a[distance=..0.1,limit=1] Inventory[{Slot:-106b}].tag.medabots_server.items.legs
execute at @s[scores={EditingTinpet=9}] as @e[tag=left_arm,tag=new] run data modify entity @s ArmorItems[3] merge from entity @a[distance=..0.1,limit=1] Inventory[{Slot:-106b}].tag.medabots_server.items.left_arm
execute at @s[scores={EditingTinpet=9}] as @e[tag=right_arm,tag=new] run data modify entity @s ArmorItems[3] merge from entity @a[distance=..0.1,limit=1] Inventory[{Slot:-106b}].tag.medabots_server.items.right_arm
execute at @s[scores={EditingTinpet=9}] as @e[tag=head,tag=new] run data modify entity @s ArmorItems[3] merge from entity @a[distance=..0.1,limit=1] Inventory[{Slot:-106b}].tag.medabots_server.items.head
execute at @s[scores={EditingTinpet=9}] as @e[tag=medal,tag=new] run data modify entity @s ArmorItems[3] merge from entity @a[distance=..0.1,limit=1] Inventory[{Slot:-106b}].tag.medabots_server.items.medal
tag @e[tag=medabot_model,tag=new] remove new

execute in minecraft:overworld run setblock -286 0 -52 minecraft:shulker_box{Items:[{Slot:0b,id:"minecraft:stone",Count:1b}]}
execute in minecraft:overworld if entity @s[nbt={SelectedItem:{}}] run data modify block -286 0 -52 Items[0] merge from entity @s SelectedItem
execute in minecraft:overworld unless entity @s[nbt={SelectedItem:{}}] run data modify block -286 0 -52 Items[0] merge from entity @s Inventory:[{Slot:-106b}]
execute in minecraft:overworld run data remove block -286 0 -52 Items[0].tag.medabots_server.activated
execute in minecraft:overworld if entity @s[nbt={SelectedItem:{}}] run loot replace entity @s weapon.mainhand 1 mine -286 0 -52 minecraft:golden_pickaxe{phi:{drop_contents:true}}
execute in minecraft:overworld unless entity @s[nbt={SelectedItem:{}}] run loot replace entity @s weapon.offhand 1 mine -286 0 -52 minecraft:golden_pickaxe{phi:{drop_contents:true}}
execute in minecraft:overworld run setblock -286 0 -52 minecraft:bedrock