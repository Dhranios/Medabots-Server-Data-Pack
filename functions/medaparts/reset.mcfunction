# Reset medaforce
replaceitem entity @s[nbt={Inventory:[{Slot:4b,tag:{medabots_server:{id:"medabots_server:kuwagata_medal",activated:1b}}}]}] hotbar.4 minecraft:nether_star{display:{Name:"{\"italic\":false,\"color\":\"white\",\"translate\":\"medabots_server:item.kuwagata_medal\"}",Lore:["{\"italic\":false,\"color\":\"white\",\"translate\":\"medabots_server:move.kuwagata\"}","{\"italic\":false,\"color\":\"white\",\"translate\":\"medabots_server:move.kuwagata.description\"}","{\"italic\":false,\"color\":\"white\",\"translate\":\"medabots_server:item.part.wave\",\"with\":[{\"text\":\"1\"}]}"]},medabots_server:{id:"medabots_server:kuwagata_medal",move:"medaforce_charge",part:"medal",activated:0b,version:1}}
replaceitem entity @s[nbt={Inventory:[{Slot:4b,tag:{medabots_server:{id:"medabots_server:kabuto_medal",activated:1b}}}]}] hotbar.4 minecraft:nether_star{display:{Name:"{\"italic\":false,\"color\":\"white\",\"translate\":\"medabots_server:item.kabuto_medal\"}",Lore:["{\"italic\":false,\"color\":\"white\",\"translate\":\"medabots_server:move.kabuto\"}","{\"italic\":false,\"color\":\"white\",\"translate\":\"medabots_server:move.kabuto.description\"}","{\"italic\":false,\"color\":\"white\",\"translate\":\"medabots_server:item.part.wave\",\"with\":[{\"text\":\"1\"}]}"]},medabots_server:{id:"medabots_server:kabuto_medal",move:"medaforce_charge",part:"medal",activated:0b,version:1}}
replaceitem entity @s[nbt={Inventory:[{Slot:4b,tag:{medabots_server:{id:"medabots_server:mermaid_medal",activated:1b}}}]}] hotbar.4 minecraft:nether_star{display:{Name:"{\"italic\":false,\"color\":\"white\",\"translate\":\"medabots_server:item.mermaid_medal\"}",Lore:["{\"italic\":false,\"color\":\"white\",\"translate\":\"medabots_server:move.mermaid\"}","{\"italic\":false,\"color\":\"white\",\"translate\":\"medabots_server:move.mermaid.description\"}","{\"italic\":false,\"color\":\"white\",\"translate\":\"medabots_server:item.part.wave\",\"with\":[{\"text\":\"1\"}]}"]},medabots_server:{id:"medabots_server:mermaid_medal",move:"medaforce_charge",part:"medal",activated:0b,version:1}}
replaceitem entity @s[nbt={Inventory:[{Slot:4b,tag:{medabots_server:{id:"medabots_server:ghost_medal",activated:1b}}}]}] hotbar.4 minecraft:nether_star{display:{Name:"{\"italic\":false,\"color\":\"white\",\"translate\":\"medabots_server:item.ghost_medal\"}",Lore:["{\"italic\":false,\"color\":\"white\",\"translate\":\"medabots_server:move.ghost\"}","{\"italic\":false,\"color\":\"white\",\"translate\":\"medabots_server:move.ghost.description\"}","{\"italic\":false,\"color\":\"white\",\"translate\":\"medabots_server:item.part.wave\",\"with\":[{\"text\":\"1\"}]}"]},medabots_server:{id:"medabots_server:ghost_medal",move:"medaforce_charge",part:"medal",activated:0b,version:1}}
replaceitem entity @s[nbt={Inventory:[{Slot:4b,tag:{medabots_server:{id:"medabots_server:monkey_medal",activated:1b}}}]}] hotbar.4 minecraft:nether_star{display:{Name:"{\"italic\":false,\"color\":\"white\",\"translate\":\"medabots_server:item.monkey_medal\"}",Lore:["{\"italic\":false,\"color\":\"white\",\"translate\":\"medabots_server:move.monkey\"}","{\"italic\":false,\"color\":\"white\",\"translate\":\"medabots_server:move.monkey.description\"}","{\"italic\":false,\"color\":\"white\",\"translate\":\"medabots_server:item.part.wave\",\"with\":[{\"text\":\"1\"}]}"]},medabots_server:{id:"medabots_server:monkey_medal",move:"medaforce_charge",part:"medal",activated:0b,version:1}}
replaceitem entity @s[nbt={Inventory:[{Slot:4b,tag:{medabots_server:{id:"medabots_server:spider_medal",activated:1b}}}]}] hotbar.4 minecraft:nether_star{display:{Name:"{\"italic\":false,\"color\":\"white\",\"translate\":\"medabots_server:item.spider_medal\"}",Lore:["{\"italic\":false,\"color\":\"white\",\"translate\":\"medabots_server:move.spider\"}","{\"italic\":false,\"color\":\"white\",\"translate\":\"medabots_server:move.spider.description\"}","{\"italic\":false,\"color\":\"white\",\"translate\":\"medabots_server:item.part.wave\",\"with\":[{\"text\":\"1\"}]}"]},medabots_server:{id:"medabots_server:spidar_medal",move:"medaforce_charge",part:"medal",activated:0b,version:1}}
replaceitem entity @s[nbt={Inventory:[{Slot:4b,tag:{medabots_server:{id:"medabots_server:alien_medal",activated:1b}}}]}] hotbar.4 minecraft:nether_star{display:{Name:"{\"italic\":false,\"color\":\"white\",\"translate\":\"medabots_server:item.alien_medal\"}",Lore:["{\"italic\":false,\"color\":\"white\",\"translate\":\"medabots_server:move.alien\"}","{\"italic\":false,\"color\":\"white\",\"translate\":\"medabots_server:move.alien.description\"}","{\"italic\":false,\"color\":\"white\",\"translate\":\"medabots_server:item.part.wave\",\"with\":[{\"text\":\"1\"}]}"]},medabots_server:{id:"medabots_server:alien_medal",move:"medaforce_charge",part:"medal",activated:0b,version:1}}
replaceitem entity @s[nbt={Inventory:[{Slot:4b,tag:{medabots_server:{id:"medabots_server:question_medal",activated:1b}}}]}] hotbar.4 minecraft:nether_star{display:{Name:"{\"italic\":false,\"color\":\"white\",\"translate\":\"medabots_server:item.question_medal\"}",Lore:["{\"italic\":false,\"color\":\"white\",\"translate\":\"medabots_server:move.question\"}","{\"italic\":false,\"color\":\"white\",\"translate\":\"medabots_server:move.question.description\"}","{\"italic\":false,\"color\":\"white\",\"translate\":\"medabots_server:item.part.wave\",\"with\":[{\"text\":\"1\"}]}"]},medabots_server:{id:"medabots_server:question_medal",move:"medaforce_charge",part:"medal",activated:0b,version:1}}
replaceitem entity @s[nbt={Inventory:[{Slot:4b,tag:{medabots_server:{id:"medabots_server:activate_kuwagata_medaforce",activated:1b}}}]}] hotbar.4 minecraft:nether_star{display:{Name:"{\"italic\":false,\"color\":\"white\",\"translate\":\"medabots_server:item.kuwagata_medal\"}",Lore:["{\"italic\":false,\"color\":\"white\",\"translate\":\"medabots_server:move.kuwagata\"}","{\"italic\":false,\"color\":\"white\",\"translate\":\"medabots_server:move.kuwagata.description\"}","{\"italic\":false,\"color\":\"white\",\"translate\":\"medabots_server:item.part.wave\",\"with\":[{\"text\":\"1\"}]}"]},medabots_server:{id:"medabots_server:kuwagata_medal",move:"medaforce_charge",part:"medal",activated:0b,version:1}}
replaceitem entity @s[nbt={Inventory:[{Slot:4b,tag:{medabots_server:{id:"medabots_server:activate_kabuto_medaforce",activated:1b}}}]}] hotbar.4 minecraft:nether_star{display:{Name:"{\"italic\":false,\"color\":\"white\",\"translate\":\"medabots_server:item.kabuto_medal\"}",Lore:["{\"italic\":false,\"color\":\"white\",\"translate\":\"medabots_server:move.kabuto\"}","{\"italic\":false,\"color\":\"white\",\"translate\":\"medabots_server:move.kabuto.description\"}","{\"italic\":false,\"color\":\"white\",\"translate\":\"medabots_server:item.part.wave\",\"with\":[{\"text\":\"1\"}]}"]},medabots_server:{id:"medabots_server:kabuto_medal",move:"medaforce_charge",part:"medal",activated:0b,version:1}}
replaceitem entity @s[nbt={Inventory:[{Slot:4b,tag:{medabots_server:{id:"medabots_server:activate_mermaid_medaforce",activated:1b}}}]}] hotbar.4 minecraft:nether_star{display:{Name:"{\"italic\":false,\"color\":\"white\",\"translate\":\"medabots_server:item.mermaid_medal\"}",Lore:["{\"italic\":false,\"color\":\"white\",\"translate\":\"medabots_server:move.mermaid\"}","{\"italic\":false,\"color\":\"white\",\"translate\":\"medabots_server:move.mermaid.description\"}","{\"italic\":false,\"color\":\"white\",\"translate\":\"medabots_server:item.part.wave\",\"with\":[{\"text\":\"1\"}]}"]},medabots_server:{id:"medabots_server:mermaid_medal",move:"medaforce_charge",part:"medal",activated:0b,version:1}}
replaceitem entity @s[nbt={Inventory:[{Slot:4b,tag:{medabots_server:{id:"medabots_server:activate_ghost_medaforce",activated:1b}}}]}] hotbar.4 minecraft:nether_star{display:{Name:"{\"italic\":false,\"color\":\"white\",\"translate\":\"medabots_server:item.ghost_medal\"}",Lore:["{\"italic\":false,\"color\":\"white\",\"translate\":\"medabots_server:move.ghost\"}","{\"italic\":false,\"color\":\"white\",\"translate\":\"medabots_server:move.ghost.description\"}","{\"italic\":false,\"color\":\"white\",\"translate\":\"medabots_server:item.part.wave\",\"with\":[{\"text\":\"1\"}]}"]},medabots_server:{id:"medabots_server:ghost_medal",move:"medaforce_charge",part:"medal",activated:0b,version:1}}
replaceitem entity @s[nbt={Inventory:[{Slot:4b,tag:{medabots_server:{id:"medabots_server:activate_monkey_medaforce",activated:1b}}}]}] hotbar.4 minecraft:nether_star{display:{Name:"{\"italic\":false,\"color\":\"white\",\"translate\":\"medabots_server:item.monkey_medal\"}",Lore:["{\"italic\":false,\"color\":\"white\",\"translate\":\"medabots_server:move.monkey\"}","{\"italic\":false,\"color\":\"white\",\"translate\":\"medabots_server:move.monkey.description\"}","{\"italic\":false,\"color\":\"white\",\"translate\":\"medabots_server:item.part.wave\",\"with\":[{\"text\":\"1\"}]}"]},medabots_server:{id:"medabots_server:monkey_medal",move:"medaforce_charge",part:"medal",activated:0b,version:1}}
replaceitem entity @s[nbt={Inventory:[{Slot:4b,tag:{medabots_server:{id:"medabots_server:activate_spider_medaforce",activated:1b}}}]}] hotbar.4 minecraft:nether_star{display:{Name:"{\"italic\":false,\"color\":\"white\",\"translate\":\"medabots_server:item.spider_medal\"}",Lore:["{\"italic\":false,\"color\":\"white\",\"translate\":\"medabots_server:move.spider\"}","{\"italic\":false,\"color\":\"white\",\"translate\":\"medabots_server:move.spider.description\"}","{\"italic\":false,\"color\":\"white\",\"translate\":\"medabots_server:item.part.wave\",\"with\":[{\"text\":\"1\"}]}"]},medabots_server:{id:"medabots_server:spidar_medal",move:"medaforce_charge",part:"medal",activated:0b,version:1}}
replaceitem entity @s[nbt={Inventory:[{Slot:4b,tag:{medabots_server:{id:"medabots_server:activate_alien_medaforce",activated:1b}}}]}] hotbar.4 minecraft:nether_star{display:{Name:"{\"italic\":false,\"color\":\"white\",\"translate\":\"medabots_server:item.alien_medal\"}",Lore:["{\"italic\":false,\"color\":\"white\",\"translate\":\"medabots_server:move.alien\"}","{\"italic\":false,\"color\":\"white\",\"translate\":\"medabots_server:move.alien.description\"}","{\"italic\":false,\"color\":\"white\",\"translate\":\"medabots_server:item.part.wave\",\"with\":[{\"text\":\"1\"}]}"]},medabots_server:{id:"medabots_server:alien_medal",move:"medaforce_charge",part:"medal",activated:0b,version:1}}
replaceitem entity @s[nbt={Inventory:[{Slot:4b,tag:{medabots_server:{id:"medabots_server:activate_question_medaforce",activated:1b}}}]}] hotbar.4 minecraft:nether_star{display:{Name:"{\"italic\":false,\"color\":\"white\",\"translate\":\"medabots_server:item.question_medal\"}",Lore:["{\"italic\":false,\"color\":\"white\",\"translate\":\"medabots_server:move.question\"}","{\"italic\":false,\"color\":\"white\",\"translate\":\"medabots_server:move.question.description\"}","{\"italic\":false,\"color\":\"white\",\"translate\":\"medabots_server:item.part.wave\",\"with\":[{\"text\":\"1\"}]}"]},medabots_server:{id:"medabots_server:question_medal",move:"medaforce_charge",part:"medal",activated:0b,version:1}}
scoreboard players set @s[scores={Medaforce=1..}] Medaforce 0
scoreboard players set @s[scores={Charge=1..}] Charge 0

# Deactivate parts
execute store result entity @s Inventory[{tag:{medabots_server:{activated:1b}}}].tag.medabots_server.activated byte 1 run scoreboard players get #0 Constants

# Remove status effects
scoreboard players set @s[scores={AuxiliaryTime=1..}] AuxiliaryTime 1
scoreboard players set @s[scores={BugTime=1..}] BugTime 1
scoreboard players set @s[scores={ConfuseTime=1..}] ConfuseTime 1
scoreboard players set @s[scores={DefenseTime=1..}] DefenseTime 1
scoreboard players set @s[scores={FreezeTime=1..}] FreezeTime 1
scoreboard players set @s[scores={HideTime=1..}] HideTime 1
scoreboard players set @s[scores={HoldTime=1..}] HoldTime 1
scoreboard players set @s[scores={IneffectiveTime=1..}] IneffectiveTime 1
scoreboard players set @s[scores={InfectTime=1..}] InfectTime 1
scoreboard players set @s[scores={NoDefendTime=1..}] NoDefendTime 1
scoreboard players set @s[scores={OverHeatingFly=1..}] OverHeatingFly 1
scoreboard players set @s[scores={OverheatingMedal=1..}] OverheatingMedal 1
scoreboard players set @s[scores={ParalyzeTime=1..}] ParalyzeTime 1
scoreboard players set @s[scores={PerfectGuardTime=1..}] PerfectGuardTime 1
scoreboard players set @s[scores={ScoutTime=1..}] ScoutTime 1
tag @s[tag=static_fly] remove static_fly
tag @s[tag=blocked_medaforce] remove blocked_medaforce

# Un-set combat
execute at @e[tag=medabot_model] if score @s MedabotNr = @e[distance=..0.1,tag=medabot_model,limit=1] MedabotNr run kill @e[distance=..0.1,tag=medabot_model,limit=1]
execute as @e[scores={MedabotNr=1..}] if score @s MedabotNr > @e[distance=..0.1,tag=hostile,limit=1] MedabotNr run scoreboard players remove @s MedabotNr 1
scoreboard players reset @s MedabotNr
effect clear @s minecraft:invisibility
tag @s remove hostile
scoreboard players reset @s Stage

# Remove medabot indexing
tag @s remove enemy_medabot
tag @s remove 1
tag @s remove 2
tag @s remove 3
tag @s remove 4
tag @s remove 5
tag @s remove 6
tag @s remove 7
tag @s remove 8
tag @s remove 9

# Re-give items who have stage_item:1b
execute at @s[nbt={Inventory:[{tag:{medabots_server:{stage_item:1b}}}]}] run function medabots_server:stage/give_obtained_item

# Re-equip headgear
replaceitem entity @s[tag=had_sunglasses_equipped] armor.head minecraft:chainmail_helmet{Unbreakable:1b,HideFlags:4,display:{Name:"{\"italic\":false,\"color\":\"white\",\"translate\":\"medabots_server:item.sunglasses\"}"},AttributeModifiers:[],medabots_server:{id:"medabots_server:sunglasses"}}
tag @s[tag=had_sunglasses_equipped] remove had_sunglasses_equipped
replaceitem entity @s[tag=had_master_crown_equipped] armor.head minecraft:golden_helmet{Unbreakable:1b,HideFlags:4,display:{Name:"{\"italic\":false,\"color\":\"white\",\"translate\":\"medabots_server:item.master_crown\"}",Lore:["{\"italic\":false,\"color\":\"white\",\"translate\":\"medabots_server:item.master_crown.description\"}"]},AttributeModifiers:[],medabots_server:{id:"medabots_server:master_crown"}}
tag @s[tag=had_master_crown_equipped] remove had_sunglasses_equipped