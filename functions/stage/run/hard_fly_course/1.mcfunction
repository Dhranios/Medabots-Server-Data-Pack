# Show next ring
particle minecraft:dust 1 0 0 1 -510.5 90.5 267 1.5 1.5 0 1 5 force @a[scores={Rings=0}]
particle minecraft:dust 1 0 0 1 -509.5 73 275.5 1.5 0 1.5 1 5 force @a[scores={Rings=1}]
particle minecraft:dust 1 0 0 1 -509.5 53 275.5 1.5 0 1.5 1 5 force @a[scores={Rings=2}]
particle minecraft:dust 1 0 0 1 -521 49.5 275.5 0 1.5 1.5 1 5 force @a[scores={Rings=3}]
particle minecraft:dust 1 0 0 1 -538 50.5 275.5 0 1.5 1.5 1 5 force @a[scores={Rings=4}]
particle minecraft:dust 1 0 0 1 -549 59.5 275.5 0 1.5 1.5 1 5 force @a[scores={Rings=5}]
particle minecraft:dust 1 0 0 1 -559 70.5 268 2 1.5 2 1 5 force @a[scores={Rings=6}]
particle minecraft:dust 1 0 0 1 -570.5 72.5 246 1.5 1.5 0 1 5 force @a[scores={Rings=7}]
particle minecraft:dust 1 0 0 1 -560 70.5 235.5 0 1.5 1.5 1 5 force @a[scores={Rings=8}]
particle minecraft:dust 1 0 0 1 -550 68.5 238 2 1.5 2 1 5 force @a[scores={Rings=9}]
particle minecraft:dust 1 0 0 1 -541 63.5 248.5 0 1.5 1.5 1 5 force @a[scores={Rings=10}]
particle minecraft:dust 1 0 0 1 -528 58.5 248.5 0 1.5 1.5 1 5 force @a[scores={Rings=11}]
particle minecraft:dust 1 0 0 1 -516 49.5 248.5 0 1.5 1.5 1 5 force @a[scores={Rings=12}]
particle minecraft:dust 1 0 0 1 -497 48.5 248.5 0 1.5 1.5 1 5 force @a[scores={Rings=13}]
particle minecraft:dust 1 0 0 1 -484 55.5 248.5 0 1.5 1.5 1 5 force @a[scores={Rings=14}]
particle minecraft:dust 1 0 0 1 -468.5 62 249.5 1.5 0 1.5 1 5 force @a[scores={Rings=15}]
particle minecraft:dust 1 0 0 1 -450 68.5 242.5 0 1.5 1.5 1 5 force @a[scores={Rings=16}]
particle minecraft:dust 1 0 0 1 -433 56.5 243.5 0 1.5 1.5 1 5 force @a[scores={Rings=17}]
particle minecraft:dust 1 0 0 1 -416 49.5 244.5 0 1.5 1.5 1 5 force @a[scores={Rings=18}]
particle minecraft:dust 1 0 0 1 -399 51.5 243.5 0 1.5 1.5 1 5 force @a[scores={Rings=19}]
particle minecraft:dust 1 0 0 1 -391.5 60 243.5 1.5 0 1.5 1 5 force @a[scores={Rings=20}]
particle minecraft:dust 1 0 0 1 -391.5 70 243.5 1.5 0 1.5 1 5 force @a[scores={Rings=21}]
particle minecraft:dust 1 0 0 1 -391.5 78 243.5 1.5 0 1.5 1 5 force @a[scores={Rings=22}]
particle minecraft:dust 1 0 0 1 -391.5 87 242.5 1.5 0 1.5 1 5 force @a[scores={Rings=23}]
particle minecraft:dust 1 0 0 1 -392.5 97 242.5 1.5 0 1.5 1 5 force @a[scores={Rings=24}]
particle minecraft:dust 1 0 0 1 -392.5 111.5 237 1.5 1.5 0 1 5 force @a[scores={Rings=25}]
particle minecraft:dust 1 0 0 1 -391.5 97 223.5 1.5 0 1.5 1 5 force @a[scores={Rings=26}]
particle minecraft:dust 1 0 0 1 -391.5 87 223.5 1.5 0 1.5 1 5 force @a[scores={Rings=27}]
particle minecraft:dust 1 0 0 1 -398.5 79.5 223.5 0 1.5 1.5 1 5 force @a[scores={Rings=28}]
particle minecraft:dust 1 0 0 1 -407.5 75 223.5 1.5 0 1.5 1 5 force @a[scores={Rings=29}]
particle minecraft:dust 1 0 0 1 -414 67.5 223.5 0 1.5 1.5 1 5 force @a[scores={Rings=30}]
particle minecraft:dust 1 0 0 1 -431 60.5 222.5 0 1.5 1.5 1 5 force @a[scores={Rings=31}]
particle minecraft:dust 1 0 0 1 -451 61.5 226 2 1.5 2 1 5 force @a[scores={Rings=32}]
particle minecraft:dust 1 0 0 1 -458 55.5 234 2 1.5 2 1 5 force @a[scores={Rings=33}]
particle minecraft:dust 1 0 0 1 -463.5 53.5 244 1.5 1.5 0 1 5 force @a[scores={Rings=34}]
particle minecraft:dust 1 0 0 1 -463.5 53.5 247 1.5 1.5 0 1 5 force @a[scores={Rings=35}]
particle minecraft:dust 1 0 0 1 -463.5 53.5 250 1.5 1.5 0 1 5 force @a[scores={Rings=36}]
particle minecraft:dust 1 0 0 1 -463.5 53.5 253 1.5 1.5 0 1 5 force @a[scores={Rings=37}]
particle minecraft:dust 1 0 0 1 -467 53.5 261 2 1.5 2 1 5 force @a[scores={Rings=38}]
particle minecraft:dust 1 0 0 1 -480 53.5 269 2 1.5 2 1 5 force @a[scores={Rings=39}]
particle minecraft:dust 1 0 0 1 -493.5 50.5 279 1.5 1.5 0 1 5 force @a[scores={Rings=40}]
particle minecraft:dust 1 0 0 1 -493.5 50.5 290 1.5 1.5 0 1 5 force @a[scores={Rings=41}]
particle minecraft:dust 1 0 0 1 -493.5 50.5 299 1.5 1.5 0 1 5 force @a[scores={Rings=42}]
particle minecraft:dust 1 0 0 1 -493.5 53.5 310 1.5 1.5 0 1 5 force @a[scores={Rings=43}]
particle minecraft:dust 1 0 0 1 -493.5 62 317.5 1.5 0 1.5 1 5 force @a[scores={Rings=44}]
particle minecraft:dust 1 0 0 1 -493.5 65 317.5 1.5 0 1.5 1 5 force @a[scores={Rings=45}]
particle minecraft:dust 1 0 0 1 -494.5 79.5 310 1.5 1.5 0 1 5 force @a[scores={Rings=46}]
particle minecraft:dust 1 0 0 1 -493.5 75.5 288 1.5 1.5 0 1 5 force @a[scores={Rings=47}]
particle minecraft:dust 1 0 0 1 -493.5 75.5 272 1.5 1.5 0 1 5 force @a[scores={Rings=48}]
particle minecraft:dust 1 0 0 1 -493.5 75.5 261 1.5 1.5 0 1 5 force @a[scores={Rings=49}]
particle minecraft:dust 1 0 0 1 -493.5 75.5 245 1.5 1.5 0 1 5 force @a[scores={Rings=50}]
particle minecraft:dust 1 0 0 1 -493.5 72 237.5 1.5 0 1.5 1 5 force @a[scores={Rings=51}]
particle minecraft:dust 1 0 0 1 -493.5 61.5 229 1.5 1.5 0 1 5 force @a[scores={Rings=52}]
particle minecraft:dust 1 0 0 1 -494 59 202 1 1 0 1 5 force @a[scores={Rings=53}]
particle minecraft:dust 1 0 0 1 -502 62.5 186 2 1.5 2 1 5 force @a[scores={Rings=54}]
particle minecraft:dust 1 0 0 1 -509.5 69 176.5 1.5 0 1.5 1 5 force @a[scores={Rings=55}]
particle minecraft:dust 1 0 0 1 -509.5 73 176.5 1.5 0 1.5 1 5 force @a[scores={Rings=56}]
particle minecraft:dust 1 0 0 1 -509.5 84.5 196 1.5 1.5 0 1 5 force @a[scores={Rings=57}]
particle minecraft:dust 1 0 0 1 -509.5 77 205.5 1.5 0 1.5 1 5 force @a[scores={Rings=58}]
particle minecraft:dust 1 0 0 1 -509.5 69.5 210 1.5 1.5 0 1 5 force @a[scores={Rings=59}]
particle minecraft:dust 1 0 0 1 -509.5 73.5 221 1.5 1.5 0 1 5 force @a[scores={Rings=60}]
particle minecraft:dust 1 0 0 1 -509.5 63.5 233 1.5 1.5 0 1 5 force @a[scores={Rings=61}]
particle minecraft:dust 1 0 0 1 -509.5 65.5 248 1.5 1.5 0 1 5 force @a[scores={Rings=62}]
particle minecraft:dust 1 0 0 1 -509.5 62.5 251 1.5 1.5 0 1 5 force @a[scores={Rings=63}]
particle minecraft:dust 1 0 0 1 -509.5 68 257.5 1.5 0 1.5 1 5 force @a[scores={Rings=64}]
particle minecraft:dust 1 0 0 1 -510.5 90.5 267 1.5 1.5 0 1 5 force @a[scores={Rings=65}]

# Got ring
execute if entity @s[x=-512,y=89,z=267,dx=3,dy=3,dz=0,scores={Rings=0},y_rotation=-90..90] run function medabots_server:stage/fly_course/got_ring
execute if entity @s[x=-511,y=73,z=274,dx=3,dy=0,dz=3,scores={Rings=1},x_rotation=0..90] run function medabots_server:stage/fly_course/got_ring
execute if entity @s[x=-511,y=53,z=274,dx=3,dy=0,dz=3,scores={Rings=2},x_rotation=0..90] run function medabots_server:stage/fly_course/got_ring
execute if entity @s[x=-521,y=48,z=274,dx=0,dy=3,dz=3,scores={Rings=3},y_rotation=0..-180] run function medabots_server:stage/fly_course/got_ring
execute if entity @s[x=-538,y=49,z=274,dx=0,dy=3,dz=3,scores={Rings=4},y_rotation=0..-180] run function medabots_server:stage/fly_course/got_ring
execute if entity @s[x=-549,y=58,z=274,dx=0,dy=3,dz=3,scores={Rings=5},y_rotation=0..-180] run function medabots_server:stage/fly_course/got_ring
execute if entity @s[x=-561,y=69,z=266,dx=4,dy=3,dz=4,scores={Rings=6},y_rotation=45..-135] run function medabots_server:stage/fly_course/got_ring
execute if entity @s[x=-572,y=71,z=246,dx=3,dy=3,dz=0,scores={Rings=7},y_rotation=90..-90] run function medabots_server:stage/fly_course/got_ring
execute if entity @s[x=-560,y=69,z=233,dx=0,dy=3,dz=3,scores={Rings=8},y_rotation=-180..0] run function medabots_server:stage/fly_course/got_ring
execute if entity @s[x=-552,y=67,z=236,dx=4,dy=3,dz=4,scores={Rings=9},y_rotation=-135..45] run function medabots_server:stage/fly_course/got_ring
execute if entity @s[x=-541,y=62,z=247,dx=0,dy=3,dz=3,scores={Rings=10},y_rotation=-180..0] run function medabots_server:stage/fly_course/got_ring
execute if entity @s[x=-528,y=57,z=247,dx=0,dy=3,dz=3,scores={Rings=11},y_rotation=-180..0] run function medabots_server:stage/fly_course/got_ring
execute if entity @s[x=-516,y=48,z=247,dx=0,dy=3,dz=3,scores={Rings=12},y_rotation=-180..0] run function medabots_server:stage/fly_course/got_ring
execute if entity @s[x=-497,y=47,z=247,dx=0,dy=3,dz=3,scores={Rings=13},y_rotation=-180..0] run function medabots_server:stage/fly_course/got_ring
execute if entity @s[x=-484,y=54,z=247,dx=0,dy=3,dz=3,scores={Rings=14},y_rotation=-180..0] run function medabots_server:stage/fly_course/got_ring
execute if entity @s[x=-470,y=62,z=248,dx=3,dy=0,dz=3,scores={Rings=15},x_rotation=-90..0] run function medabots_server:stage/fly_course/got_ring
execute if entity @s[x=-450,y=67,z=241,dx=0,dy=3,dz=3,scores={Rings=16},y_rotation=-180..0] run function medabots_server:stage/fly_course/got_ring
execute if entity @s[x=-433,y=56,z=242,dx=0,dy=3,dz=3,scores={Rings=17},y_rotation=-180..0] run function medabots_server:stage/fly_course/got_ring
execute if entity @s[x=-416,y=49,z=243,dx=0,dy=3,dz=3,scores={Rings=18},y_rotation=-180..0] run function medabots_server:stage/fly_course/got_ring
execute if entity @s[x=-399,y=51,z=242,dx=0,dy=3,dz=3,scores={Rings=19},y_rotation=-180..0] run function medabots_server:stage/fly_course/got_ring
execute if entity @s[x=-393,y=60,z=242,dx=3,dy=0,dz=3,scores={Rings=20},x_rotation=-90..0] run function medabots_server:stage/fly_course/got_ring
execute if entity @s[x=-393,y=70,z=242,dx=3,dy=0,dz=3,scores={Rings=21},x_rotation=-90..0] run function medabots_server:stage/fly_course/got_ring
execute if entity @s[x=-393,y=78,z=242,dx=3,dy=0,dz=3,scores={Rings=22},x_rotation=-90..0] run function medabots_server:stage/fly_course/got_ring
execute if entity @s[x=-393,y=87,z=241,dx=3,dy=0,dz=3,scores={Rings=23},x_rotation=-90..0] run function medabots_server:stage/fly_course/got_ring
execute if entity @s[x=-394,y=97,z=241,dx=3,dy=0,dz=3,scores={Rings=24},x_rotation=-90..0] run function medabots_server:stage/fly_course/got_ring
execute if entity @s[x=-394,y=110,z=237,dx=3,dy=3,dz=0,scores={Rings=25},y_rotation=90..-90] run function medabots_server:stage/fly_course/got_ring
execute if entity @s[x=-393,y=97,z=222,dx=3,dy=0,dz=3,scores={Rings=26},x_rotation=0..90] run function medabots_server:stage/fly_course/got_ring
execute if entity @s[x=-393,y=87,z=222,dx=3,dy=0,dz=3,scores={Rings=27},x_rotation=0..90] run function medabots_server:stage/fly_course/got_ring
execute if entity @s[x=-400,y=78,z=222,dx=0,dy=3,dz=3,scores={Rings=28},y_rotation=0..-180] run function medabots_server:stage/fly_course/got_ring
execute if entity @s[x=-409,y=75,z=222,dx=3,dy=0,dz=3,scores={Rings=29},x_rotation=0..90] run function medabots_server:stage/fly_course/got_ring
execute if entity @s[x=-414,y=66,z=222,dx=0,dy=3,dz=3,scores={Rings=30},y_rotation=0..-180] run function medabots_server:stage/fly_course/got_ring
execute if entity @s[x=-431,y=59,z=221,dx=0,dy=3,dz=3,scores={Rings=31},y_rotation=0..-180] run function medabots_server:stage/fly_course/got_ring
execute if entity @s[x=-453,y=60,z=224,dx=4,dy=3,dz=4,scores={Rings=32},y_rotation=-45..135] run function medabots_server:stage/fly_course/got_ring
execute if entity @s[x=-460,y=54,z=232,dx=4,dy=3,dz=4,scores={Rings=33},y_rotation=-45..135] run function medabots_server:stage/fly_course/got_ring
execute if entity @s[x=-465,y=52,z=244,dx=3,dy=3,dz=0,scores={Rings=34},y_rotation=-90..90] run function medabots_server:stage/fly_course/got_ring
execute if entity @s[x=-465,y=52,z=247,dx=3,dy=3,dz=0,scores={Rings=35},y_rotation=-90..90] run function medabots_server:stage/fly_course/got_ring
execute if entity @s[x=-465,y=52,z=250,dx=3,dy=3,dz=0,scores={Rings=36},y_rotation=-90..90] run function medabots_server:stage/fly_course/got_ring
execute if entity @s[x=-465,y=52,z=253,dx=3,dy=3,dz=0,scores={Rings=37},y_rotation=-90..90] run function medabots_server:stage/fly_course/got_ring
execute if entity @s[x=-469,y=52,z=259,dx=4,dy=3,dz=4,scores={Rings=38},y_rotation=-45..135] run function medabots_server:stage/fly_course/got_ring
execute if entity @s[x=-482,y=52,z=267,dx=4,dy=3,dz=4,scores={Rings=39},y_rotation=-45..135] run function medabots_server:stage/fly_course/got_ring
execute if entity @s[x=-495,y=49,z=279,dx=3,dy=3,dz=0,scores={Rings=40},y_rotation=-90..90] run function medabots_server:stage/fly_course/got_ring
execute if entity @s[x=-495,y=49,z=290,dx=3,dy=3,dz=0,scores={Rings=41},y_rotation=-90..90] run function medabots_server:stage/fly_course/got_ring
execute if entity @s[x=-495,y=49,z=299,dx=3,dy=3,dz=0,scores={Rings=42},y_rotation=-90..90] run function medabots_server:stage/fly_course/got_ring
execute if entity @s[x=-495,y=52,z=310,dx=3,dy=3,dz=0,scores={Rings=43},y_rotation=-90..90] run function medabots_server:stage/fly_course/got_ring
execute if entity @s[x=-495,y=62,z=316,dx=3,dy=0,dz=3,scores={Rings=44},x_rotation=-90..0] run function medabots_server:stage/fly_course/got_ring
execute if entity @s[x=-495,y=65,z=316,dx=3,dy=0,dz=3,scores={Rings=45},x_rotation=-90..0] run function medabots_server:stage/fly_course/got_ring
execute if entity @s[x=-496,y=78,z=310,dx=3,dy=3,dz=0,scores={Rings=46},y_rotation=90..-90] run function medabots_server:stage/fly_course/got_ring
execute if entity @s[x=-495,y=74,z=288,dx=3,dy=3,dz=0,scores={Rings=47},y_rotation=90..-90] run function medabots_server:stage/fly_course/got_ring
execute if entity @s[x=-495,y=74,z=272,dx=3,dy=3,dz=0,scores={Rings=48},y_rotation=90..-90] run function medabots_server:stage/fly_course/got_ring
execute if entity @s[x=-495,y=74,z=261,dx=3,dy=3,dz=0,scores={Rings=49},y_rotation=90..-90] run function medabots_server:stage/fly_course/got_ring
execute if entity @s[x=-495,y=74,z=245,dx=3,dy=3,dz=0,scores={Rings=50},y_rotation=90..-90] run function medabots_server:stage/fly_course/got_ring
execute if entity @s[x=-495,y=72,z=236,dx=3,dy=0,dz=3,scores={Rings=51},x_rotation=0..90] run function medabots_server:stage/fly_course/got_ring
execute if entity @s[x=-495,y=60,z=229,dx=3,dy=3,dz=0,scores={Rings=52},y_rotation=90..-90] run function medabots_server:stage/fly_course/got_ring
execute if entity @s[x=-495,y=58,z=202,dx=2,dy=2,dz=0,scores={Rings=53},y_rotation=90..-90] run function medabots_server:stage/fly_course/got_ring
execute if entity @s[x=-503,y=61,z=184,dx=4,dy=3,dz=4,scores={Rings=54},y_rotation=45..-135] run function medabots_server:stage/fly_course/got_ring
execute if entity @s[x=-511,y=69,z=175,dx=3,dy=0,dz=3,scores={Rings=55},x_rotation=-90..0] run function medabots_server:stage/fly_course/got_ring
execute if entity @s[x=-511,y=73,z=175,dx=3,dy=0,dz=3,scores={Rings=56},x_rotation=-90..0] run function medabots_server:stage/fly_course/got_ring
execute if entity @s[x=-511,y=83,z=196,dx=3,dy=3,dz=0,scores={Rings=57},y_rotation=-90..90] run function medabots_server:stage/fly_course/got_ring
execute if entity @s[x=-511,y=77,z=204,dx=3,dy=0,dz=3,scores={Rings=58},x_rotation=0..90] run function medabots_server:stage/fly_course/got_ring
execute if entity @s[x=-511,y=68,z=210,dx=3,dy=3,dz=0,scores={Rings=59},y_rotation=-90..90] run function medabots_server:stage/fly_course/got_ring
execute if entity @s[x=-511,y=72,z=221,dx=3,dy=3,dz=0,scores={Rings=60},y_rotation=-90..90] run function medabots_server:stage/fly_course/got_ring
execute if entity @s[x=-511,y=62,z=233,dx=3,dy=3,dz=0,scores={Rings=61},y_rotation=-90..90] run function medabots_server:stage/fly_course/got_ring
execute if entity @s[x=-511,y=64,z=248,dx=3,dy=3,dz=0,scores={Rings=62},y_rotation=-90..90] run function medabots_server:stage/fly_course/got_ring
execute if entity @s[x=-511,y=61,z=251,dx=3,dy=3,dz=0,scores={Rings=63},y_rotation=-90..90] run function medabots_server:stage/fly_course/got_ring
execute if entity @s[x=-511,y=68,z=256,dx=3,dy=0,dz=3,scores={Rings=64},x_rotation=-90..0] run function medabots_server:stage/fly_course/got_ring
execute if entity @s[x=-512,y=89,z=267,dx=3,dy=3,dz=0,scores={Rings=65},y_rotation=-90..90] run function medabots_server:stage/fly_course/got_final_ring

# Cleared the stage
advancement grant @s[scores={RingsTotal=196..},tag=!lap_race] only medabots_server:stages/wave_1/hard_fly_course_1
advancement grant @s[scores={RingsTotal=3..},tag=lap_race] only medabots_server:stages/wave_1/hard_fly_course_1
advancement grant @s[scores={FlyCourseLapTime=..93,RingsTotal=196},tag=!lap_race] only medabots_server:developer_challenge/hard_fly_course_1_no_detours
advancement grant @s[scores={FlyCourseLapTime=..93,RingsTotal=3},tag=lap_race] only medabots_server:developer_challenge/hard_fly_course_1_no_detours

# End
execute if entity @s[scores={FlyCourse=0}] run kill @e[type=minecraft:firework_rocket,distance=..2]
teleport @s[scores={FlyCourse=0}] -465 90 267 90 0
teleport @s[scores={FlyCourse=3}] -465 90 267 90 0
tag @s[scores={FlyCourse=0},tag=training] remove training
execute unless entity @a[scores={FlyCourse=0..2,Stage=3},tag=racer] if entity @s[scores={FlyCourse=3},tag=racer] run setblock -469 92 268 minecraft:sea_lantern
execute unless entity @a[scores={FlyCourse=0..2,Stage=3},tag=racer] if entity @s[scores={FlyCourse=3},tag=racer] run data merge block -468 91 268 {Text1:"{\"text\":\"\",\"clickEvent\":{\"action\":\"run_command\",\"value\":\"function medabots_server:stage/sign/hard_fly_course_1/initiate_race\"}}",Text3:"{\"translate\":\"medabots_server:sign.stage.fly_course.race\"}"}
scoreboard players set @s[scores={FlyCourse=3},tag=racer] FlyCourse 4
execute unless entity @a[scores={FlyCourse=0..2,Stage=3},tag=racer] if entity @s[scores={FlyCourse=5},tag=racer] run setblock -469 92 268 minecraft:sea_lantern
execute unless entity @a[scores={FlyCourse=0..2,Stage=3},tag=racer] if entity @s[scores={FlyCourse=5},tag=racer] run data merge block -468 91 268 {Text1:"{\"text\":\"\",\"clickEvent\":{\"action\":\"run_command\",\"value\":\"function medabots_server:stage/sign/hard_fly_course_1/initiate_race\"}}",Text3:"{\"translate\":\"medabots_server:sign.stage.fly_course.race\"}"}